import{j as e,B as n,r as l,d as T,u as D,t as o,I as y,L as R,o as V,_ as B,s as M}from"./index-B_Tr2Gx0.js";import{M as E,u as A,S as I,n as S}from"./select-CsJ5AHdM.js";function O({open:t,onClose:s,onConfirm:d,title:m,message:g,confirmText:h="Confirmar",cancelText:f="Cancelar",variant:j="danger",loading:c=!1}){const v=()=>{d(),s()},N={danger:"bg-red-600 hover:bg-red-700 text-white",warning:"bg-yellow-600 hover:bg-yellow-700 text-white",info:"bg-blue-600 hover:bg-blue-700 text-white"};return e.jsx(E,{open:t,onClose:s,title:m,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:g}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(n,{variant:"ghost",onClick:s,disabled:c,children:f}),e.jsx(n,{onClick:v,disabled:c,className:N[j],children:c?"Processando...":h})]})]})})}function Q(t,s){const[d,m]=l.useState(t);return l.useEffect(()=>{const g=setTimeout(()=>{m(t)},s);return()=>{clearTimeout(g)}},[t,s]),d}const z=["mg","g","kg","ml","l","un"],U=V({name:M().min(1,"Nome √© obrigat√≥rio"),unit:B(z),quantity:S().nonnegative("Quantidade n√£o pode ser negativa").default(0),pricePerGram:S().nonnegative("Pre√ßo por grama n√£o pode ser negativo").optional()});function _(t,s){switch(s){case"kg":return t*1e3;case"g":return t;case"mg":return t/1e3;default:return t}}function H(t){const s=t/1e3;if(s>=1)return{grams:t,best:`${s.toFixed(1)} kg`};if(t>=1)return{grams:t,best:`${t.toFixed(1)} g`};const d=t*1e3;return{grams:t,best:`${d.toFixed(1)} mg`}}function J(){const{items:t,list:s,create:d,update:m,remove:g,loading:h,error:f}=A(),j=T(U),{register:c,handleSubmit:v,reset:N,formState:{errors:a}}=D({resolver:j,defaultValues:{name:"",unit:"g",quantity:0}}),[u,w]=l.useState(""),[G,p]=l.useState(!1),[x,P]=l.useState(null),C=Q(u,300);l.useEffect(()=>{s().catch(()=>o.error("Falha ao carregar produtos"))},[s]);const F=async r=>{try{const i=_(r.quantity,r.unit);await d({name:r.name,quantity:i}),o.success("Produto adicionado com sucesso"),N({name:"",unit:"g",quantity:0}),p(!1)}catch{o.error("Erro ao adicionar produto")}},$=async r=>{try{await g(r),o.success("Produto removido com sucesso"),P(null)}catch{o.error("Erro ao remover produto")}},L=()=>{var i,b,k;const r=((i=a.name)==null?void 0:i.message)||((b=a.unit)==null?void 0:b.message)||((k=a.quantity)==null?void 0:k.message)||"Verifique os campos";o.error(String(r))};l.useEffect(()=>{f&&o.error(f)},[f]);const q=l.useMemo(()=>{if(!Array.isArray(t))return[];const r=C.trim().toLowerCase();return r?t.filter(i=>i.name.toLowerCase().includes(r)):t},[t,C]);return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Produtos"}),e.jsx("p",{className:"text-gray-600",children:"Gerencie seu estoque de ingredientes"})]}),e.jsx(n,{variant:"secondary",onClick:()=>p(!0),className:"bg-gradient-to-r from-orange-500 to-amber-600 hover:from-orange-600 hover:to-amber-700 text-white font-semibold px-6 py-3 rounded-xl shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-[1.02]",children:"+ Novo Produto"})]}),e.jsx("div",{className:"card p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx(y,{value:u,onChange:r=>w(r.target.value),placeholder:"Buscar produtos por nome...",className:"w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all duration-200"})}),u&&e.jsx(n,{variant:"ghost",onClick:()=>w(""),className:"px-4 py-3 text-gray-600 hover:text-gray-800",children:"Limpar"})]})}),h&&e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(R,{size:"lg"}),e.jsx("span",{className:"ml-3 text-lg text-gray-600",children:"Carregando produtos..."})]}),e.jsx(E,{open:G,onClose:()=>p(!1),title:"Cadastrar Novo Produto",children:e.jsxs("form",{onSubmit:v(F,L),className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome do Produto"}),e.jsx(y,{...c("name"),placeholder:"Ex.: Farinha de Trigo",className:"w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all duration-200"}),a.name&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:a.name.message})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantidade"}),e.jsx(y,{type:"number",step:"any",...c("quantity"),className:"w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all duration-200"}),a.quantity&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:a.quantity.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Unidade"}),e.jsx(I,{...c("unit"),className:"w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all duration-200",children:z.map(r=>e.jsx("option",{value:r,children:r},r))}),a.unit&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:a.unit.message})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pre√ßo por Grama (R$)"}),e.jsx(y,{type:"number",step:"0.001",...c("pricePerGram"),placeholder:"Ex.: 0.025",className:"w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all duration-200"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Pre√ßo por grama para c√°lculos de receita (opcional)"}),a.pricePerGram&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:a.pricePerGram.message})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200",children:[e.jsx(n,{type:"button",variant:"ghost",onClick:()=>p(!1),className:"px-6 py-2 text-gray-600 hover:text-gray-800",children:"Cancelar"}),e.jsx(n,{type:"submit",className:"bg-gradient-to-r from-orange-500 to-amber-600 hover:from-orange-600 hover:to-amber-700 text-white font-semibold px-6 py-2 rounded-lg shadow-lg hover:shadow-xl transition-all duration-200",children:"Salvar Produto"})]})]})}),!h&&e.jsx("div",{className:"grid lg:grid-cols-3 md:grid-cols-2 gap-6",children:q.map(r=>{const i=H(r.quantity),b=r.quantity<100;return e.jsxs("div",{className:"card card-hover p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center text-white text-lg ${b?"bg-gradient-to-r from-red-500 to-rose-600":"bg-gradient-to-r from-emerald-500 to-green-600"}`,children:"üì¶"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:r.name}),e.jsx("p",{className:"text-sm text-gray-600",children:"Estoque atual"})]})]}),e.jsx("div",{className:`px-3 py-1 rounded-full text-xs font-medium ${b?"bg-red-100 text-red-700":"bg-green-100 text-green-700"}`,children:i.best})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Estoque base:"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[i.grams.toFixed(0),"g"]})]}),r.pricePerGram&&e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Pre√ßo/grama:"}),e.jsxs("span",{className:"font-medium text-green-600",children:["R$ ",r.pricePerGram.toFixed(3)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{variant:"ghost",size:"sm",onClick:async()=>{try{await m(r.id,{quantity:r.quantity+100}),o.success("Estoque atualizado (+100g)")}catch{o.error("Erro ao atualizar estoque")}},className:"flex-1 bg-green-50 hover:bg-green-100 text-green-700 px-3 py-2 rounded-lg text-sm font-medium",children:"+100g"}),e.jsx(n,{variant:"ghost",size:"sm",onClick:async()=>{try{await m(r.id,{quantity:Math.max(0,r.quantity-100)}),o.success("Estoque atualizado (-100g)")}catch{o.error("Erro ao atualizar estoque")}},className:"flex-1 bg-orange-50 hover:bg-orange-100 text-orange-700 px-3 py-2 rounded-lg text-sm font-medium",children:"-100g"})]}),e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>P({id:r.id,name:r.name}),className:"w-full text-red-600 hover:text-red-700 hover:bg-red-50 px-3 py-2 rounded-lg text-sm font-medium",children:"Remover Produto"})]})]},r.id)})}),!h&&q.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("span",{className:"text-2xl",children:"üì¶"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:u?"Nenhum produto encontrado":"Nenhum produto cadastrado"}),e.jsx("p",{className:"text-gray-600 mb-4",children:u?"Tente ajustar sua busca":"Comece adicionando seus primeiros ingredientes"}),u?e.jsx(n,{variant:"ghost",onClick:()=>w(""),className:"px-6 py-3 text-gray-600 hover:text-gray-800",children:"Limpar busca"}):e.jsx(n,{onClick:()=>p(!0),className:"bg-gradient-to-r from-orange-500 to-amber-600 hover:from-orange-600 hover:to-amber-700 text-white font-semibold px-6 py-3 rounded-xl shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-[1.02]",children:"Adicionar Primeiro Produto"})]}),e.jsx(O,{open:!!x,onClose:()=>P(null),onConfirm:()=>x&&$(x.id),title:"Confirmar Exclus√£o",message:`Tem certeza que deseja remover o produto "${x==null?void 0:x.name}"?`,confirmText:"Remover",cancelText:"Cancelar",variant:"danger"})]})}const X=l.memo(J);export{X as default};
